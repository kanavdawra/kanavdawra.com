{"id":359,"date":"2022-01-19T04:51:20","date_gmt":"2022-01-19T04:51:20","guid":{"rendered":"https:\/\/kanavdawra.com\/?p=359"},"modified":"2022-02-09T18:53:35","modified_gmt":"2022-02-09T18:53:35","slug":"i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too","status":"publish","type":"post","link":"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/","title":{"rendered":"I Deployed My ML App in a Few Easy Steps and You Can Do It Too"},"content":{"rendered":"\n<p>Are you looking for a job in the data science space? Are you a developer? Are you building your machine learning portfolio? <\/p>\n\n\n\n<p>If your and is <strong>YES<\/strong> to any of the above questions then you need to learn how to deploy an app.<\/p>\n\n\n\n<p>How to approach this problem? Let&#8217;s see<\/p>\n\n\n\n<ol><li>What do you want to achieve?<\/li><li>How many users per month are you expecting?<\/li><li>Is this a hobby project? etc.<\/li><\/ol>\n\n\n\n<p>Depending on the answer there can be a variety of solutions, you can use a serverless environment or if have a lot of loads go ahead with your own server.<\/p>\n\n\n\n<p>We will use Google Cloud Platforms. Specifically Google Cloud Functions<\/p>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"gcp-cloud-functions\">GCP: Cloud Functions<\/h2>\n\n\n\n<p>Why Cloud Functions? The answer is because I want to deploy a hobby project and won&#8217;t have that much load on the server unless you guys are going to give me a lot of traffic. And the best part is it&#8217;s totally free if you aren&#8217;t going to have a lot of traffic. I have deployed the project discussed here at <a href=\"https:\/\/kanavdawra.com\/portfolio\/hrecognizer\/\" target=\"_blank\" rel=\"noreferrer noopener\">https:\/\/kanavdawra.com\/portfolio\/hrecognizer\/<\/a><\/p>\n\n\n\n<p>Enough talk let&#8217;s start<\/p>\n\n\n\n<h3 class=\"wp-block-heading\" id=\"roadmap\">Roadmap<\/h3>\n\n\n\n<ol><li>Create new project.<\/li><li>Upload your machine learning model to `Cloud Storage`<\/li><li>Write a &#8216;Cloud Function&#8217;<\/li><\/ol>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"create-new-project\">Create new Project<\/h4>\n\n\n\n<ul><li>Assuming you have your GCP account, click on the down arrow to create the new project at the top bar<\/li><\/ul>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"471\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_1-1024x471.png\" alt=\"\" class=\"wp-image-360\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_1-1024x471.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_1-300x138.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_1-768x354.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_1-1536x707.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_1-800x368.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_1.png 1920w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<ul><li>Click on new project.<\/li><\/ul>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"476\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_2-1024x476.png\" alt=\"\" class=\"wp-image-361\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_2-1024x476.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_2-300x139.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_2-768x357.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_2-1536x714.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_2-800x372.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_2.png 1915w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<ul><li>Choose the name of your preference then click create<\/li><\/ul>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"471\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_3-1024x471.png\" alt=\"\" class=\"wp-image-362\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_3-1024x471.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_3-300x138.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_3-768x354.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_3-1536x707.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_3-800x368.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_create_project_3.png 1920w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"cloud-storage\">Cloud Storage<\/h4>\n\n\n\n<ul><li>Search Cloud Storage and click on `CREATE BUCKET`<\/li><\/ul>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"470\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_1-1024x470.png\" alt=\"\" class=\"wp-image-363\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_1-1024x470.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_1-300x138.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_1-768x353.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_1-1536x706.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_1-800x368.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_1.png 1920w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<ol><li>Choose the name of your preference and click continue<\/li><\/ol>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"472\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_2-1024x472.png\" alt=\"\" class=\"wp-image-364\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_2-1024x472.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_2-300x138.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_2-768x354.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_2-1536x708.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_2-800x369.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_2.png 1905w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<ul><li>If you want free tier make sure to choose us-west1 or other free tier regions<\/li><\/ul>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"470\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_3-1024x470.png\" alt=\"\" class=\"wp-image-365\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_3-1024x470.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_3-300x138.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_3-768x352.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_3-1536x705.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_3-800x367.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_3.png 1920w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<ol><li>Select defalut option for every other setting and you will see $0.00 monthly cost<\/li><\/ol>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"471\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_4-1024x471.png\" alt=\"\" class=\"wp-image-366\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_4-1024x471.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_4-300x138.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_4-768x353.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_4-1536x706.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_4-800x368.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_4.png 1919w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<ul><li>Create folder and upload your model in it<\/li><\/ul>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"471\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_5-1024x471.png\" alt=\"\" class=\"wp-image-367\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_5-1024x471.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_5-300x138.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_5-768x353.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_5-1536x706.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_5-800x368.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_storage_5.png 1918w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"cloud-functions\">Cloud Functions<\/h4>\n\n\n\n<ul><li>Click on `CREATE FUNCTION`<\/li><\/ul>\n\n\n\n<figure class=\"wp-block-image size-large is-resized\"><img loading=\"lazy\" decoding=\"async\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_1-1024x466.png\" alt=\"\" class=\"wp-image-368\" width=\"844\" height=\"384\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_1-1024x466.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_1-300x137.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_1-768x350.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_1-1536x699.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_1-800x364.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_1.png 1916w\" sizes=\"(max-width: 844px) 100vw, 844px\" \/><\/figure>\n\n\n\n<ul><li>Choose the name of your preference <\/li><\/ul>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"476\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_2-1024x476.png\" alt=\"\" class=\"wp-image-370\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_2-1024x476.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_2-300x139.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_2-768x357.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_2-1536x714.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_2-800x372.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_2.png 1885w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<ul><li>Now this is important you need to make sure you allocate enough memory that your model need to run <\/li><\/ul>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"468\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_3-1024x468.png\" alt=\"\" class=\"wp-image-371\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_3-1024x468.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_3-300x137.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_3-768x351.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_3-1536x702.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_3-800x365.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_3.png 1918w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<ol><li>And finaly write the code which we will see in the nect section<\/li><\/ol>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"471\" src=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_4-1024x471.png\" alt=\"\" class=\"wp-image-372\" srcset=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_4-1024x471.png 1024w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_4-300x138.png 300w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_4-768x354.png 768w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_4-1536x707.png 1536w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_4-800x368.png 800w, https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_cloud_function_4.png 1920w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<p>Let&#8217;s write code<\/p>\n\n\n\n<h3 class=\"wp-block-heading\" id=\"code\">Code<\/h3>\n\n\n\n<p>I will write the code in python 3.9 you choose you<\/p>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"roadmap\">Roadmap<\/h4>\n\n\n\n<ol><li>Download the model in temporary storage <\/li><li>Preprocess your data <\/li><li>Get prediction <\/li><li>Return prediction in JSON\/text <\/li><li>Make sure CORS setting are correct<\/li><li>Make the api Authenticated\/Unauthenticated<\/li><\/ol>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"import-all-the-libraries\">Import all the libraries<\/h4>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">from google.cloud import storage\nimport tensorflow as tf\nfrom PIL import Image\nimport numpy as np\nimport os   \nfrom ImagePreprocessor import *\nimport flask<\/pre>\n\n\n\n<p>Create all the global variables<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">MODEL = None\nnum_to_char = None\n\nBUCKET_NAME = \"BUCKET-NAME\" # name of GCP bucket<\/pre>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"function-to-download-the-model\">Function to download the model<\/h4>\n\n\n\n<p>Since my model has a folder structure I need to make the structure in the temp directory<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">def download_blob(bucket_name, source_blob_name, destination_blob_name):\n    download_directory = destination_blob_name\n    variables_directory = os.path.join(destination_blob_name, \"variables\")\n    if not os.path.exists(download_directory):\n        print('download_dir createing')\n        os.makedirs(download_directory)\n        print('download_dir created')\n\n    if not os.path.exists(variables_directory):\n        print('variable_dir creating')\n        os.makedirs(variables_directory)\n        print('variable_dir created')\n\n\n    storage_client = storage.Client()\n\n    bucket = storage_client.get_bucket(bucket_name)\n    print(bucket)\n    print(bucket.name)\n    sub_folders = bucket.list_blobs(prefix=source_blob_name)\n\n    for file in sub_folders:\n        print('file: ',file.name)\n        print('file type: ',type(file.name))\n        if file.name != 'FOLDER-NAME':     # Bucket folder Name\n            print(file.name)\n            print(os.path.basename(file.name))\n            download_path = os.path.join(download_directory, os.path.basename(file.name))\n            print(download_path)\n            if \"variables\" in file.name:\n                download_path = os.path.join(variables_directory, os.path.basename(file.name))\n            file.download_to_filename(download_path)\n\n    print(f\"Blob {source_blob_name} downloaded to {destination_blob_name}.\")\n<\/pre>\n\n\n\n<p>After writing the function to download model<\/p>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"function-for-data-preprocessing\">Function for data preprocessing<\/h4>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">def preprocess_image(data):\n    image = decode_image(data)\n    image = convert_image_float32(image)\n    image = transpose_image(image, [1, 2, 0])\n    image = image_resize(image, (200, 50))\n    image = transpose_image(image, [1, 0, 2])\n    image = flip_left_to_right(image)\n    return image<\/pre>\n\n\n\n<p>Here I am preprocessing the data in the same way I did for model training. All the functions are within ImagePreprocessor.py<\/p>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"function-to-create-batch-object\">Function to create batch object<\/h4>\n\n\n\n<p>Now this is optional since I am using DNN model I need to make batch predictions<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">def get_dict_data(image):\n    label = tf.constant([99, 99, 99, 99, 99, 99, 99, 99, 99, 99,\n                         99, 99, 99, 99, 99, 99, 99, 99, 99, 99,\n                         99, 99, 99, 99, 99, 99, 99, 99, 99, 99,\n                         99, 99, 99, 99])\n\n    image = tf.expand_dims(image, axis=0)\n    label = tf.expand_dims(label, axis=0)\n\n    batch_object = {'image': image, 'label': label}\n    return batch_object<\/pre>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"function-to-decode-prediction\">Function to decode prediction<\/h4>\n\n\n\n<p>In this function, you with decode the prediction if it is in probabilities or any other format which needs to be decoded<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">def decode_batch_predictions(pred):\n    input_len = np.ones(pred.shape[0]) * pred.shape[1]\n    # Use greedy search. For complex tasks, you can use beam search.\n    results = tf.keras.backend.ctc_decode(pred, input_length=input_len, greedy=True)[0][0][:, :34]\n    # Iterate over the results and get back the text.\n    output_text = []\n    for res in results:\n        res = tf.gather(res, tf.where(tf.math.not_equal(res, -1)))\n        res = tf.strings.reduce_join(num_to_char(res)).numpy().decode(\"utf-8\")\n        output_text.append(res)\n    return output_text<\/pre>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"entry-point-function\">Entry Point Function<\/h4>\n\n\n\n<p>This is the function where the magic happens, when someone hits the API it data comes to this function<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">def predict(request):\n\n    if request.method == 'OPTIONS':\n        headers = {\n            # 'Access-Control-Allow-Origin': 'https:\/\/mydomain.com',\n            'Access-Control-Allow-Origin': '*',\n            'Access-Control-Allow-Methods': 'GET, POST',\n            'Access-Control-Allow-Headers': 'Content-Type',\n            'Access-Control-Max-Age': '3600'\n            # 'Access-Control-Allow-Credentials': 'true'\n        }\n        return ('', 204, headers)<\/pre>\n\n\n\n<p>This is the generic code to handle the CORS request, more details can be found at <a href=\"https:\/\/cloud.google.com\/functions\/docs\/samples\/functions-http-cors\" target=\"_blank\" rel=\"noreferrer noopener\">https:\/\/cloud.google.com\/functions\/docs\/samples\/functions-http-cors<\/a><\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">    global MODEL\n    global num_to_char\n\n    if MODEL is None:\n        download_blob(BUCKET_NAME,'Models\/tf\/HRecognizer','\/tmp\/HRecognizer')\n        MODEL = tf.keras.models.load_model(\"\/tmp\/HRecognizer\")<\/pre>\n\n\n\n<p>This code download the model to a temporary directory and load the model <\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">    if num_to_char is None:\n        vocab = ['[UNK]', 's', 'Z', 't', 'i', 'p', 'H', 'm', 'z', 'g', 'S', 'J', 'N', '`', 'o', 'y', 'e', 'u', 'E', 'M', 'b',\n            'v', 'B', 'L', 'V', 'F', 'l', 'I', 'T', 'A', 'U', 'a', 'h', 'R', 'r', '-', 'W', ' ', 'P', 'n', 'c', 'Y', 'O',\n            'C', 'K', 'X', 'f', 'G', 'D', 'Q', \"'\"]\n        num_to_char = tf.keras.layers.StringLookup(vocabulary=vocab, mask_token=None, invert=True)\n\n    image_file = request.files[\"file\"]<\/pre>\n\n\n\n<p>This code gets the file from the form where the filename is `file` you can name it anything<\/p>\n\n\n\n<h4 class=\"wp-block-heading\" id=\"finally-we-predict\">Finally we predict <\/h4>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">    print('Preprocessing Image...')\n    image = preprocess_image(image_file)\n    print('Getting Batch Object...')\n    batch_object = get_dict_data(image)\n    print('Getting Prediction...')\n    prediction = MODEL.predict(batch_object)\n    print('Decoding Prediction...')\n    prediction = decode_batch_predictions(prediction)\n    print('Returning Prediction...')\n    print('pred type', type(prediction))\n    print('pred',prediction)\n    print(prediction[0])<\/pre>\n\n\n\n<p>Now we need to add the headers so the browser can accept the response<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">    headers = {\n        'Content-Type':'application\/json',\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Headers': 'Content-Type',\n    }\n\n\n    return (prediction[0], 200, headers)<\/pre>\n\n\n\n<p>here in the return, we are returning a tuple with prediction, status code, headers<\/p>\n\n\n\n<h3 class=\"wp-block-heading\" id=\"and-we-are-done-with-the-code\">And we are done with the code<\/h3>\n\n\n\n<p>Now click on deploy it may take a few minutes <\/p>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"recap\">Recap<\/h2>\n\n\n\n<ol><li>We created the bucket and uploaded our model<\/li><li>We create a new function with adequate memory (Important)<\/li><li>In the code we downloaded the model loaded it<\/li><li>Then we preprocessed the data.<\/li><li>Added CORS headers<\/li><li>Returned the preduction<\/li><\/ol>\n\n\n\n<h3 class=\"wp-block-heading\" id=\"find-my-project-at-https-kanavdawra-com-portfolio-hrecognizer\">Find my Project at <a href=\"https:\/\/kanavdawra.com\/portfolio\/hrecognizer\/\" target=\"_blank\" rel=\"noreferrer noopener\">https:\/\/kanavdawra.com\/portfolio\/hrecognizer\/<\/a><\/h3>\n\n\n\n<p> <\/p>\n","protected":false},"excerpt":{"rendered":"<p>Are you looking for a job in the data science space? Are you a developer? Are you building your machine learning portfolio? If your and is YES to any of the above questions then you need to learn how to deploy an app. How to approach this problem? Let&#8217;s see What do you want to [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":374,"comment_status":"open","ping_status":"open","sticky":false,"template":"single.php","format":"standard","meta":{"spay_email":"","footnotes":""},"categories":[3],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v21.8 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>I Deployed My ML App in a Few Easy Steps and You Can Do It Too - Kanav Dawra<\/title>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"I Deployed My ML App in a Few Easy Steps and You Can Do It Too - Kanav Dawra\" \/>\n<meta property=\"og:description\" content=\"Are you looking for a job in the data science space? Are you a developer? Are you building your machine learning portfolio? If your and is YES to any of the above questions then you need to learn how to deploy an app. How to approach this problem? Let&#8217;s see What do you want to [&hellip;]\" \/>\n<meta property=\"og:url\" content=\"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/\" \/>\n<meta property=\"og:site_name\" content=\"Kanav Dawra\" \/>\n<meta property=\"article:published_time\" content=\"2022-01-19T04:51:20+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-02-09T18:53:35+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_thumbnail.jpg\" \/>\n\t<meta property=\"og:image:width\" content=\"917\" \/>\n\t<meta property=\"og:image:height\" content=\"386\" \/>\n\t<meta property=\"og:image:type\" content=\"image\/jpeg\" \/>\n<meta name=\"author\" content=\"kanavdawra_admin-716\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<meta name=\"twitter:label1\" content=\"Written by\" \/>\n\t<meta name=\"twitter:data1\" content=\"kanavdawra_admin-716\" \/>\n\t<meta name=\"twitter:label2\" content=\"Est. reading time\" \/>\n\t<meta name=\"twitter:data2\" content=\"7 minutes\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebPage\",\"@id\":\"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/\",\"url\":\"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/\",\"name\":\"I Deployed My ML App in a Few Easy Steps and You Can Do It Too - Kanav Dawra\",\"isPartOf\":{\"@id\":\"https:\/\/kanavdawra.com\/#website\"},\"datePublished\":\"2022-01-19T04:51:20+00:00\",\"dateModified\":\"2022-02-09T18:53:35+00:00\",\"author\":{\"@id\":\"https:\/\/kanavdawra.com\/#\/schema\/person\/465cae08f44cccb05b5d7c55beb512ce\"},\"breadcrumb\":{\"@id\":\"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/#breadcrumb\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/\"]}]},{\"@type\":\"BreadcrumbList\",\"@id\":\"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/#breadcrumb\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"name\":\"Home\",\"item\":\"https:\/\/kanavdawra.com\/\"},{\"@type\":\"ListItem\",\"position\":2,\"name\":\"I Deployed My ML App in a Few Easy Steps and You Can Do It Too\"}]},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/kanavdawra.com\/#website\",\"url\":\"https:\/\/kanavdawra.com\/\",\"name\":\"Kanav Dawra\",\"description\":\"Data Science\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https:\/\/kanavdawra.com\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"Person\",\"@id\":\"https:\/\/kanavdawra.com\/#\/schema\/person\/465cae08f44cccb05b5d7c55beb512ce\",\"name\":\"kanavdawra_admin-716\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https:\/\/kanavdawra.com\/#\/schema\/person\/image\/\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/9ee5994c2536fd1d22469184c8b4680d?s=96&d=mm&r=g\",\"contentUrl\":\"https:\/\/secure.gravatar.com\/avatar\/9ee5994c2536fd1d22469184c8b4680d?s=96&d=mm&r=g\",\"caption\":\"kanavdawra_admin-716\"},\"sameAs\":[\"https:\/\/kanavdawra.com\"],\"url\":\"https:\/\/kanavdawra.com\/author\/kanavdawra_admin-716\/\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"I Deployed My ML App in a Few Easy Steps and You Can Do It Too - Kanav Dawra","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/","og_locale":"en_US","og_type":"article","og_title":"I Deployed My ML App in a Few Easy Steps and You Can Do It Too - Kanav Dawra","og_description":"Are you looking for a job in the data science space? Are you a developer? Are you building your machine learning portfolio? If your and is YES to any of the above questions then you need to learn how to deploy an app. How to approach this problem? Let&#8217;s see What do you want to [&hellip;]","og_url":"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/","og_site_name":"Kanav Dawra","article_published_time":"2022-01-19T04:51:20+00:00","article_modified_time":"2022-02-09T18:53:35+00:00","og_image":[{"width":917,"height":386,"url":"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_thumbnail.jpg","type":"image\/jpeg"}],"author":"kanavdawra_admin-716","twitter_card":"summary_large_image","twitter_misc":{"Written by":"kanavdawra_admin-716","Est. reading time":"7 minutes"},"schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebPage","@id":"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/","url":"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/","name":"I Deployed My ML App in a Few Easy Steps and You Can Do It Too - Kanav Dawra","isPartOf":{"@id":"https:\/\/kanavdawra.com\/#website"},"datePublished":"2022-01-19T04:51:20+00:00","dateModified":"2022-02-09T18:53:35+00:00","author":{"@id":"https:\/\/kanavdawra.com\/#\/schema\/person\/465cae08f44cccb05b5d7c55beb512ce"},"breadcrumb":{"@id":"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/"]}]},{"@type":"BreadcrumbList","@id":"https:\/\/kanavdawra.com\/blog\/i-deployed-my-ml-app-in-a-few-easy-steps-and-you-can-do-it-too\/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/kanavdawra.com\/"},{"@type":"ListItem","position":2,"name":"I Deployed My ML App in a Few Easy Steps and You Can Do It Too"}]},{"@type":"WebSite","@id":"https:\/\/kanavdawra.com\/#website","url":"https:\/\/kanavdawra.com\/","name":"Kanav Dawra","description":"Data Science","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https:\/\/kanavdawra.com\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Person","@id":"https:\/\/kanavdawra.com\/#\/schema\/person\/465cae08f44cccb05b5d7c55beb512ce","name":"kanavdawra_admin-716","image":{"@type":"ImageObject","inLanguage":"en-US","@id":"https:\/\/kanavdawra.com\/#\/schema\/person\/image\/","url":"https:\/\/secure.gravatar.com\/avatar\/9ee5994c2536fd1d22469184c8b4680d?s=96&d=mm&r=g","contentUrl":"https:\/\/secure.gravatar.com\/avatar\/9ee5994c2536fd1d22469184c8b4680d?s=96&d=mm&r=g","caption":"kanavdawra_admin-716"},"sameAs":["https:\/\/kanavdawra.com"],"url":"https:\/\/kanavdawra.com\/author\/kanavdawra_admin-716\/"}]}},"jetpack_featured_media_url":"https:\/\/kanavdawra.com\/wp-content\/uploads\/2022\/01\/3_thumbnail.jpg","acf":[],"_links":{"self":[{"href":"https:\/\/kanavdawra.com\/wp-json\/wp\/v2\/posts\/359"}],"collection":[{"href":"https:\/\/kanavdawra.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/kanavdawra.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/kanavdawra.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/kanavdawra.com\/wp-json\/wp\/v2\/comments?post=359"}],"version-history":[{"count":6,"href":"https:\/\/kanavdawra.com\/wp-json\/wp\/v2\/posts\/359\/revisions"}],"predecessor-version":[{"id":384,"href":"https:\/\/kanavdawra.com\/wp-json\/wp\/v2\/posts\/359\/revisions\/384"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/kanavdawra.com\/wp-json\/wp\/v2\/media\/374"}],"wp:attachment":[{"href":"https:\/\/kanavdawra.com\/wp-json\/wp\/v2\/media?parent=359"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/kanavdawra.com\/wp-json\/wp\/v2\/categories?post=359"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/kanavdawra.com\/wp-json\/wp\/v2\/tags?post=359"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}